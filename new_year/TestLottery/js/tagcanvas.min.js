(function(){var bh,bj,bi=Math.abs,bL=Math.sin,aJ=Math.cos,aN=Math.max,bW=Math.min,bD=Math.ceil,br=Math.sqrt,by=Math.pow,aW={},aU={},aT={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},aI,a1,bd,bU,bo,bT,bS,bx=document,aQ,a2={};for(bh=0;bh<256;++bh){bj=bh.toString(16);if(bh<16){bj="0"+bj}aU[bj]=aU[bj.toUpperCase()]=bh.toString()+","}function bK(a){return typeof a!="undefined"}function i(a,b){return Math.floor(a+Math.random()*(b-a))}function bl(a){return typeof a=="object"&&a!=null}function bu(c,b,a){return isNaN(c)?a:bW(a,aN(b,c))}function bZ(){return false}function bp(){return new Date().valueOf()}function bA(a,c){var b=[],e=a.length,d;for(d=0;d<e;++d){b.push(a[d])}b.sort(c);return b}function bF(b){var d=b.length-1,a,c;while(d){c=~~(Math.random()*d);a=b[d];b[d]=b[c];b[c]=a;--d}}function bO(c,a,b){this.x=c;this.y=a;this.z=b}bo=bO.prototype;bo.length=function(){return br(this.x*this.x+this.y*this.y+this.z*this.z)};bo.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};bo.cross=function(b){var c=this.y*b.z-this.z*b.y,d=this.z*b.x-this.x*b.z,a=this.x*b.y-this.y*b.x;return new bO(c,d,a)};bo.angle=function(b){var c=this.dot(b),a;if(c==0){return Math.PI/2}a=c/(this.length()*b.length());if(a>=1){return 0}if(a<=-1){return Math.PI}return Math.acos(a)};bo.unit=function(){var a=this.length();return new bO(this.x/a,this.y/a,this.z/a)};function bJ(a,b){b=b*Math.PI/180;a=a*Math.PI/180;var c=bL(a)*aJ(b),d=-bL(b),e=-aJ(a)*aJ(b);return new bO(c,d,e)}function bc(a){this[1]={1:a[0],2:a[1],3:a[2]};this[2]={1:a[3],2:a[4],3:a[5]};this[3]={1:a[6],2:a[7],3:a[8]}}bU=bc.prototype;bc.Identity=function(){return new bc([1,0,0,0,1,0,0,0,1])};bc.Rotation=function(e,c){var b=bL(e),a=aJ(e),d=1-a;return new bc([a+by(c.x,2)*d,c.x*c.y*d-c.z*b,c.x*c.z*d+c.y*b,c.y*c.x*d+c.z*b,a+by(c.y,2)*d,c.y*c.z*d-c.x*b,c.z*c.x*d-c.y*b,c.z*c.y*d+c.x*b,a+by(c.z,2)*d])};bU.mul=function(a){var e=[],b,c,d=(a.xform?1:0);for(b=1;b<=3;++b){for(c=1;c<=3;++c){if(d){e.push(this[b][1]*a[1][c]+this[b][2]*a[2][c]+this[b][3]*a[3][c])}else{e.push(this[b][c]*a)}}}return new bc(e)};bU.xform=function(a){var b={},c=a.x,d=a.y,e=a.z;b.x=c*this[1][1]+d*this[2][1]+e*this[3][1];b.y=c*this[1][2]+d*this[2][2]+e*this[3][2];b.z=c*this[1][3]+d*this[2][3]+e*this[3][3];return b};function aP(b,m,f,k){var l,g,d,h,e=[],a=Math.PI*(3-br(5)),c=2/b;for(l=0;l<b;++l){g=l*c-1+(c/2);d=br(1-g*g);h=l*a;e.push([aJ(h)*d*m,g*f,bL(h)*d*k])}return e}function a7(a,c,m,e,g){var f,d=[],o=Math.PI*(3-br(5)),b=2/a,h,k,l,n;for(h=0;h<a;++h){k=h*b-1+(b/2);f=h*o;l=aJ(f);n=bL(f);d.push(c?[k*m,l*e,n*g]:[l*m,k*e,n*g])}return d}function bg(c,b,m,e,g,k){var f,d=[],a=Math.PI*2/b,h,l,n;for(h=0;h<b;++h){f=h*a;l=aJ(f);n=bL(f);d.push(c?[k*m,l*e,n*g]:[l*m,k*e,n*g])}return d}function bG(d,c,b,a){return a7(d,0,c,b,a)}function bw(d,c,b,a){return a7(d,1,c,b,a)}function a0(d,c,b,a,e){e=isNaN(e)?0:e*1;return bg(0,d,c,b,a,e)}function aS(d,c,b,a,e){e=isNaN(e)?0:e*1;return bg(1,d,c,b,a,e)}function bE(a){var b=new Image;b.onload=function(){var d=b.width/2,c=b.height/2;a.centreFunc=function(e,h,g,k,f){e.setTransform(1,0,0,1,0,0);e.globalAlpha=1;e.drawImage(b,k-d,f-c)}};b.src=a.centreImage}function a9(d,c){var e=d,f,a,b=(c*1).toPrecision(3)+")";if(d[0]==="#"){if(!aW[d]){if(d.length===4){aW[d]="rgba("+aT[d[1]]+aT[d[2]]+aT[d[3]]}else{aW[d]="rgba("+aU[d.substr(1,2)]+aU[d.substr(3,2)]+aU[d.substr(5,2)]}}e=aW[d]+b}else{if(d.substr(0,4)==="rgb("||d.substr(0,4)==="hsl("){e=(d.replace("(","a(").replace(")",","+b))}else{if(d.substr(0,5)==="rgba("||d.substr(0,5)==="hsla("){f=d.lastIndexOf(",")+1,a=d.indexOf(")");c*=parseFloat(d.substring(f,a));e=d.substr(0,f)+c.toPrecision(3)+")"}}}return e}function be(c,b){if(window.G_vmlCanvasManager){return null}var a=bx.createElement("canvas");a.width=c;a.height=b;return a}function bH(){var b=be(3,3),c,a;if(!b){return false}c=b.getContext("2d");c.strokeStyle="#000";c.shadowColor="#fff";c.shadowBlur=3;c.globalAlpha=0;c.strokeRect(2,2,2,2);c.globalAlpha=1;a=c.getImageData(2,2,1,1);b=null;return(a.data[0]>0)}function bI(c,b,d,e){var f=c.createLinearGradient(0,0,b,0),a;for(a in e){f.addColorStop(1-a,e[a])}c.fillStyle=f;c.fillRect(0,d,b,1)}function aV(a,c,d){var b=1024,g=1,h=a.weightGradient,k,e,l,f;if(a.gCanvas){e=a.gCanvas.getContext("2d");g=a.gCanvas.height}else{if(bl(h[0])){g=h.length}else{h=[h]}a.gCanvas=k=be(b,g);if(!k){return null}e=k.getContext("2d");for(l=0;l<g;++l){bI(e,b,l,h[l])}}d=aN(bW(d||0,g-1),0);f=e.getImageData(~~((b-1)*c),d,1,1).data;return"rgba("+f[0]+","+f[1]+","+f[2]+","+(f[3]/255)+")"}function a6(l,a,d,f,g,k,m,q,b,h,r,n){var o=g+(q||0)+(b.length&&b[0]<0?bi(b[0]):0),c=k+(q||0)+(b.length&&b[1]<0?bi(b[1]):0),p,e;l.font=a;l.textBaseline="top";l.fillStyle=d;m&&(l.shadowColor=m);q&&(l.shadowBlur=q);b.length&&(l.shadowOffsetX=b[0],l.shadowOffsetY=b[1]);for(p=0;p<f.length;++p){e=0;if(r){if("right"==n){e=h-r[p]}else{if("centre"==n){e=(h-r[p])/2}}}l.fillText(f[p],o+e,c);
c+=parseInt(a)}}function bB(d,c,e,b,g,f,a){if(f){d.beginPath();d.moveTo(c,e+g-f);d.arcTo(c,e,c+f,e,f);d.arcTo(c+b,e,c+b,e+f,f);d.arcTo(c+b,e+g,c+b-f,e+g,f);d.arcTo(c,e+g,c,e+g-f,f);d.closePath();d[a?"stroke":"fill"]()}else{d[a?"strokeRect":"fillRect"](c,e,b,g)}}function aX(f,e,h,b,g,c,a,k,d){this.strings=f;this.font=e;this.width=h;this.height=b;this.maxWidth=g;this.stringWidths=c;this.align=a;this.valign=k;this.scale=d}bS=aX.prototype;bS.SetImage=function(f,b,h,c,g,d,a,e){this.image=f;this.iwidth=b*this.scale;this.iheight=h*this.scale;this.ipos=c;this.ipad=g*this.scale;this.iscale=e;this.ialign=d;this.ivalign=a};bS.Align=function(b,a,c){var d=0;if(c=="right"||c=="bottom"){d=a-b}else{if(c!="left"&&c!="top"){d=(a-b)/2}}return d};bS.Create=function(g,E,h,D,b,c,x,d,n){var a=["#808080","#CCC","#B3B3B3","#999"];g=a[i(0,4)];var p,r,f,y,B,C,t,u,v,w,q,s,o,e,k,z=bi(x[0]),A=bi(x[1]),m,l;d=aN(d,z+c,A+c);B=2*(d+D);t=2*(d+D);r=this.width+B;f=this.height+t;v=w=d+D;if(this.image){q=s=d+D;o=this.iwidth;e=this.iheight;if(this.ipos=="top"||this.ipos=="bottom"){if(o<this.width){q+=this.Align(o,this.width,this.ialign)}else{v+=this.Align(this.width,o,this.align)}if(this.ipos=="top"){w+=e+this.ipad}else{s+=this.height+this.ipad}r=aN(r,o+B);f+=e+this.ipad}else{if(e<this.height){s+=this.Align(e,this.height,this.ivalign)}else{w+=this.Align(this.height,e,this.valign)}if(this.ipos=="right"){q+=this.width+this.ipad}else{v+=o+this.ipad}r+=o+this.ipad;f=aN(f,e+t)}}p=be(r,f);if(!p){return null}B=t=D/2;C=r-D;u=f-D;k=bW(n,C/2,u/2);y=p.getContext("2d");if(E){y.fillStyle=E;bB(y,B,t,C,u,k)}if(D){y.strokeStyle=h;y.lineWidth=D;bB(y,B,t,C,u,k,true)}if(c||z||A){m=be(r,f);if(m){l=y;y=m.getContext("2d")}}a6(y,this.font,g,this.strings,v,w,0,0,[],this.maxWidth,this.stringWidths,this.align);if(this.image){y.drawImage(this.image,q,s,o,e)}if(l){y=l;b&&(y.shadowColor=b);c&&(y.shadowBlur=c);y.shadowOffsetX=x[0];y.shadowOffsetY=x[1];y.drawImage(m,0,0)}return p};function aK(e,b,d){var a=be(b,d),c;if(!a){return null}c=a.getContext("2d");c.drawImage(e,(b-e.width)/2,(d-e.height)/2);return a}function bq(e,b,d){var a=be(b,d),c;if(!a){return null}c=a.getContext("2d");c.drawImage(e,0,0,b,d);return a}function bX(f,m,e,a,l,n,p,h,r,q){var t=m+((2*h)+n)*a,k=e+((2*h)+n)*a,s=be(t,k),b,c,u,d,v,w,g,o;if(!s){return null}n*=a;r*=a;c=u=n/2;d=t-n;v=k-n;h=(h*a)+c;b=s.getContext("2d");o=bW(r,d/2,v/2);if(l){b.fillStyle=l;bB(b,c,u,d,v,o)}if(n){b.strokeStyle=p;b.lineWidth=n;bB(b,c,u,d,v,o,true)}if(q){w=be(t,k);g=w.getContext("2d");g.drawImage(f,h,h,m,e);g.globalCompositeOperation="source-in";g.fillStyle=p;g.fillRect(0,0,t,k);g.globalCompositeOperation="destination-over";g.drawImage(s,0,0);g.globalCompositeOperation="source-over";b.drawImage(w,0,0)}else{b.drawImage(f,h,h,f.width,f.height)}return{image:s,width:t/a,height:k/a}}function bC(k,d,a,f,e){var h,g,c=parseFloat(d),b=aN(a,f);h=be(a,f);if(!h){return null}if(d.indexOf("%")>0){c=b*c/100}else{c=c*e}g=h.getContext("2d");g.globalCompositeOperation="source-over";g.fillStyle="#fff";if(c>=b/2){c=bW(a,f)/2;g.beginPath();g.moveTo(a/2,f/2);g.arc(a/2,f/2,c,0,2*Math.PI,false);g.fill();g.closePath()}else{c=bW(a/2,f/2,c);bB(g,0,0,a,f,c,true);g.fill()}g.globalCompositeOperation="source-in";g.drawImage(k,0,0,a,f);return h}function a4(n,f,l,a,h,g,b){var e=bi(b[0]),m=bi(b[1]),q=f+(e>g?e+g:g*2)*a,d=l+(m>g?m+g:g*2)*a,o=a*((g||0)+(b[0]<0?e:0)),c=a*((g||0)+(b[1]<0?m:0)),p,k;p=be(q,d);if(!p){return null}k=p.getContext("2d");h&&(k.shadowColor=h);g&&(k.shadowBlur=g*a);b&&(k.shadowOffsetX=b[0]*a,k.shadowOffsetY=b[1]*a);k.drawImage(n,o,c,f,l);return{image:p,width:q/a,height:d/a}}function aM(e,o,g){var f=parseInt(e.toString().length*g),p=parseInt(g*2*e.length),b=be(f,p),l,d,a,m,h,k,c,n;if(!b){return null}l=b.getContext("2d");l.fillStyle="#000";l.fillRect(0,0,f,p);a6(l,g+"px "+o,"#fff",e,0,0,0,0,[],"centre");d=l.getImageData(0,0,f,p);a=d.width;m=d.height;n={min:{x:a,y:m},max:{x:-1,y:-1}};for(k=0;k<m;++k){for(h=0;h<a;++h){c=(k*a+h)*4;if(d.data[c+1]>0){if(h<n.min.x){n.min.x=h}if(h>n.max.x){n.max.x=h}if(k<n.min.y){n.min.y=k}if(k>n.max.y){n.max.y=k}}}}if(a!=f){n.min.x*=(f/a);n.max.x*=(f/a)}if(m!=p){n.min.y*=(f/m);n.max.y*=(f/m)}b=null;return n}function aR(a){return"'"+a.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function bP(c,b,a){a=a||bx;if(a.addEventListener){a.addEventListener(c,b,false)}else{a.attachEvent("on"+c,b)}}function a3(c,b,a){a=a||bx;if(a.removeEventListener){a.removeEventListener(c,b)}else{a.detachEvent("on"+c,b)}}function bs(l,c,f,m){var e=m.imageScale,h,b,k,d,a,g;if(!c.complete){return bP("load",function(){bs(l,c,f,m)},c)}if(!l.complete){return bP("load",function(){bs(l,c,f,m)},l)}c.width=c.width;c.height=c.height;if(e){l.width=c.width*e;l.height=c.height*e}f.iw=l.width;f.ih=l.height;if(m.txtOpt){b=l;h=m.zoomMax*m.txtScale;a=f.iw*h;g=f.ih*h;if(a<c.naturalWidth||g<c.naturalHeight){b=bq(l,a,g);if(b){f.fimage=b}}else{a=f.iw;g=f.ih;h=1}if(parseFloat(m.imageRadius)){f.image=f.fimage=l=bC(f.image,m.imageRadius,a,g,h)}if(!f.HasText()){if(m.shadow){b=a4(f.image,a,g,h,m.shadow,m.shadowBlur,m.shadowOffset);
if(b){f.fimage=b.image;f.w=b.width;f.h=b.height}}if(m.bgColour||m.bgOutlineThickness){k=m.bgColour=="tag"?a5(f.a,"background-color"):m.bgColour;d=m.bgOutline=="tag"?a5(f.a,"color"):(m.bgOutline||m.textColour);a=f.fimage.width;g=f.fimage.height;if(m.outlineMethod=="colour"){b=bX(f.fimage,a,g,h,k,m.bgOutlineThickness,m.outlineColour,m.padding,m.bgRadius,1);if(b){f.oimage=b.image}}b=bX(f.fimage,a,g,h,k,m.bgOutlineThickness,d,m.padding,m.bgRadius);if(b){f.fimage=b.image;f.w=b.width;f.h=b.height}}if(m.outlineMethod=="size"){if(m.outlineIncrease>0){f.iw+=2*m.outlineIncrease;f.ih+=2*m.outlineIncrease;a=h*f.iw;g=h*f.ih;b=bq(f.fimage,a,g);f.oimage=b;f.fimage=aK(f.fimage,f.oimage.width,f.oimage.height)}else{a=h*(f.iw+(2*m.outlineIncrease));g=h*(f.ih+(2*m.outlineIncrease));b=bq(f.fimage,a,g);f.oimage=aK(b,f.fimage.width,f.fimage.height)}}}}f.Init()}function a5(d,a){var b=bx.defaultView,c=a.replace(/\-([a-z])/g,function(e){return e.charAt(1).toUpperCase()});return(b&&b.getComputedStyle&&b.getComputedStyle(d,null).getPropertyValue(a))||(d.currentStyle&&d.currentStyle[c])}function aL(b,e,a){var c=1,d;if(e){c=1*(b.getAttribute(e)||a)}else{if(d=a5(b,"font-size")){c=(d.indexOf("px")>-1&&d.replace("px","")*1)||(d.indexOf("pt")>-1&&d.replace("pt","")*1.25)||d*3.3}}return c}function aY(a){return a.target&&bK(a.target.id)?a.target.id:a.srcElement.parentNode.id}function bb(e,d){var f,a,c=parseInt(a5(d,"width"))/d.width,b=parseInt(a5(d,"height"))/d.height;if(bK(e.offsetX)){f={x:e.offsetX,y:e.offsetY}}else{a=bR(d.id);if(bK(e.changedTouches)){e=e.changedTouches[0]}if(e.pageX){f={x:e.pageX-a.x,y:e.pageY-a.y}}}if(f&&c&&b){f.x/=c;f.y/=b}return f}function bz(a){var b=a.target||a.fromElement.parentNode,c=aH.tc[b.id];if(c){c.mx=c.my=-1;c.UnFreeze();c.EndDrag()}}function bN(c){var f,a=aH,b,d,e=aY(c);for(f in a.tc){b=a.tc[f];if(b.tttimer){clearTimeout(b.tttimer);b.tttimer=null}}if(e&&a.tc[e]){b=a.tc[e];if(d=bb(c,b.canvas)){b.mx=d.x;b.my=d.y;b.Drag(c,d)}b.drawn=0}}function j(d){var b=aH,c=bx.addEventListener?0:1,a=aY(d);if(a&&d.button==c&&b.tc[a]){b.tc[a].BeginDrag(d)}}function bV(d){var a=aH,b=bx.addEventListener?0:1,e=aY(d),c;if(e&&d.button==b&&a.tc[e]){c=a.tc[e];bN(d);if(!c.EndDrag()&&!c.touchState){c.Clicked(d)}}}function ba(d){var b=aY(d),c=(b&&aH.tc[b]),a;if(c&&d.changedTouches){if(d.touches.length==1&&c.touchState==0){c.touchState=1;c.BeginDrag(d);if(a=bb(d,c.canvas)){c.mx=a.x;c.my=a.y;c.drawn=0}}else{if(d.targetTouches.length==2&&c.pinchZoom){c.touchState=3;c.EndDrag();c.BeginPinch(d)}else{c.EndDrag();c.EndPinch();c.touchState=0}}}}function aO(a){var b=aY(a),c=(b&&aH.tc[b]);if(c&&a.changedTouches){switch(c.touchState){case 1:c.Draw();c.Clicked();break;case 2:c.EndDrag();break;case 3:c.EndPinch()}c.touchState=0}}function bm(c){var f,a=aH,b,d,e=aY(c);for(f in a.tc){b=a.tc[f];if(b.tttimer){clearTimeout(b.tttimer);b.tttimer=null}}b=(e&&a.tc[e]);if(b&&c.changedTouches&&b.touchState){switch(b.touchState){case 1:case 2:if(d=bb(c,b.canvas)){b.mx=d.x;b.my=d.y;if(b.Drag(c,d)){b.touchState=2}}break;case 3:b.Pinch(c)}b.drawn=0}}function bM(a){var c=aH,b=aY(a);if(b&&c.tc[b]){a.cancelBubble=true;a.returnValue=false;a.preventDefault&&a.preventDefault();c.tc[b].Wheel((a.wheelDelta||a.detail)>0)}}function bQ(c){var a,b=aH;clearTimeout(b.scrollTimer);for(a in b.tc){b.tc[a].Pause()}b.scrollTimer=setTimeout(function(){var d,e=aH;for(d in e.tc){e.tc[d].Resume()}},b.scrollPause)}function bf(){bt(bp())}function bt(c){var b=aH.tc,a;aH.NextFrame(aH.interval);c=c||bp();for(a in b){b[a].Draw(c)}}function bR(c){var l=bx.getElementById(c),e=l.getBoundingClientRect(),g=bx.documentElement,k=bx.body,h=window,b=h.pageXOffset||g.scrollLeft,f=h.pageYOffset||g.scrollTop,a=g.clientLeft||k.clientLeft,d=g.clientTop||k.clientTop;return{x:e.left+b-a,y:e.top+f-d}}function a8(b,e,d,a){var c=b.radius*b.z1/(b.z1+b.z2+e.z);return{x:e.x*c*d,y:e.y*c*a,z:e.z,w:(b.z1-e.z)/b.z2}}function bY(a){this.e=a;this.br=0;this.line=[];this.text=[];this.original=a.innerText||a.textContent}bT=bY.prototype;bT.Empty=function(){for(var a=0;a<this.text.length;++a){if(this.text[a].length){return false}}return true};bT.Lines=function(d){var e=d?1:0,c,b,a;d=d||this.e;c=d.childNodes;b=c.length;for(a=0;a<b;++a){if(c[a].nodeName=="BR"){this.text.push(this.line.join(" "));this.br=1}else{if(c[a].nodeType==3){if(this.br){this.line=[c[a].nodeValue];this.br=0}else{this.line.push(c[a].nodeValue)}}else{this.Lines(c[a])}}}e||this.br||this.text.push(this.line.join(" "));return this.text};bT.SplitWidth=function(a,b,e,f){var g,h,c,d=[];b.font=f+"px "+e;for(g=0;g<this.text.length;++g){c=this.text[g].split(/\s+/);this.line=[c[0]];for(h=1;h<c.length;++h){if(b.measureText(this.line.join(" ")+" "+c[h]).width>a){d.push(this.line.join(" "));this.line=[c[h]]}else{this.line.push(c[h])}}d.push(this.line.join(" "))}return this.text=d};function bk(b,a){this.ts=bp();this.tc=b;this.tag=a;this.x=this.y=this.w=this.h=this.sc=1;this.z=0;this.Draw=b.pulsateTo<1&&b.outlineMethod!="colour"?this.DrawPulsate:this.DrawSimple;this.radius=b.outlineRadius|0;
this.SetMethod(b.outlineMethod)}aI=bk.prototype;aI.SetMethod=function(a){var b={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],size:["PreDraw","DrawColour"],none:["LastDraw"]},c=b[a]||b.outline;if(a=="none"){this.Draw=function(){return 1}}else{this.drawFunc=this[c[1]]}this[c[0]]=this.Draw};aI.Update=function(g,h,f,a,l,k,b,e){var d=this.tc.outlineOffset,c=2*d;this.x=l*g+b-d;this.y=l*h+e-d;this.w=l*f+c;this.h=l*a+c;this.sc=l;this.z=k};aI.DrawOutline=function(d,c,e,b,a,f){var g=bW(this.radius,a/2,b/2);d.strokeStyle=f;bB(d,c,e,b,a,g,true)};aI.DrawColour=function(b,h,a,g,c,e,f,d,k){if(f.oimage){f.alpha=1;f.Draw(b,d,k,f.oimage);return 1}return this[f.image?"DrawColourImage":"DrawColourText"](b,h,a,g,c,e,f,d,k)};aI.DrawColourText=function(a,h,l,g,c,e,f,d,k){var b=f.colour;f.colour=e;f.alpha=1;f.Draw(a,d,k);f.colour=b;return 1};aI.DrawColourImage=function(o,l,n,k,p,e,f,d,m){var h=o.canvas,a=~~aN(l,0),b=~~aN(n,0),q=bW(h.width-a,k)+0.5|0,g=bW(h.height-b,p)+0.5|0,c;if(aQ){aQ.width=q,aQ.height=g}else{aQ=be(q,g)}if(!aQ){return this.SetMethod("outline")}c=aQ.getContext("2d");c.drawImage(h,a,b,q,g,0,0,q,g);o.clearRect(a,b,q,g);f.alpha=1;f.Draw(o,d,m);o.setTransform(1,0,0,1,0,0);o.save();o.beginPath();o.rect(a,b,q,g);o.clip();o.globalCompositeOperation="source-in";o.fillStyle=e;o.fillRect(a,b,q,g);o.restore();o.globalCompositeOperation="destination-over";o.drawImage(aQ,0,0,q,g,a,b,q,g);o.globalCompositeOperation="source-over";return 1};aI.DrawBlock=function(d,c,e,b,a,f){var g=bW(this.radius,a/2,b/2);d.fillStyle=f;bB(d,c,e,b,a,g)};aI.DrawSimple=function(d,c,b,e){var a=this.tc;d.setTransform(1,0,0,1,0,0);d.strokeStyle=a.outlineColour;d.lineWidth=a.outlineThickness;d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0;d.globalAlpha=1;return this.drawFunc(d,this.x,this.y,this.w,this.h,a.outlineColour,c,b,e)};aI.DrawPulsate=function(d,c,b,f){var e=bp()-this.ts,a=this.tc;d.setTransform(1,0,0,1,0,0);d.strokeStyle=a.outlineColour;d.lineWidth=a.outlineThickness;d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0;d.globalAlpha=a.pulsateTo+((1-a.pulsateTo)*(0.5+(aJ(2*Math.PI*e/(1000*a.pulsateTime))/2)));return this.drawFunc(d,this.x,this.y,this.w,this.h,a.outlineColour,c,b,f)};aI.Active=function(a,c,b){return(c>=this.x&&b>=this.y&&c<=this.x+this.w&&b<=this.y+this.h)};aI.PreDraw=aI.PostDraw=aI.LastDraw=bZ;function aZ(b,f,l,g,k,a,c,o,h,p,m,d,n,e){this.tc=b;this.image=null;this.text=f;this.text_original=e;this.line_widths=[];this.title=l.title||null;this.a=l;this.position=new bO(g[0],g[1],g[2]);this.x=this.y=this.z=0;this.w=k;this.h=a;this.colour=c||b.textColour;this.bgColour=o||b.bgColour;this.bgRadius=h|0;this.bgOutline=p||this.colour;this.bgOutlineThickness=m|0;this.textFont=d||b.textFont;this.padding=n|0;this.sc=this.alpha=1;this.weighted=!b.weight}a1=aZ.prototype;a1.Init=function(a){var b=this.tc;this.outline=new bk(b,this);this.textHeight=b.textHeight;if(this.HasText()){this.Measure(b.ctxt,b)}else{this.w=this.iw;this.h=this.ih}this.SetShadowColour=b.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed;this.SetDraw(b)};a1.Draw=bZ;a1.HasText=function(){return this.text&&this.text[0].length>0};a1.EqualTo=function(a){var b=a.getElementsByTagName("img");if(this.a.href!=a.href){return 0}if(b.length){return this.image.src==b[0].src}return(a.innerText||a.textContent)==this.text_original};a1.SetImage=function(a){this.image=this.fimage=a};a1.SetDraw=function(a){this.Draw=this.fimage?(a.ie>7?this.DrawImageIE:this.DrawImage):this.DrawText;a.noSelect&&(this.CheckActive=bZ)};a1.MeasureText=function(c){var e,a=this.text.length,b=0,d;for(e=0;e<a;++e){this.line_widths[e]=d=c.measureText(this.text[e]).width;b=aN(b,d)}return b};a1.Measure=function(l,g){var k=aM(this.text,this.textFont,this.textHeight),f,e,a,d,c,m,h,b,n;h=k?k.max.y+k.min.y:this.textHeight;l.font=this.font=this.textHeight+"px "+this.textFont;m=this.MeasureText(l);if(g.txtOpt){f=g.txtScale;e=f*this.textHeight;a=e+"px "+this.textFont;d=[f*g.shadowOffset[0],f*g.shadowOffset[1]];l.font=a;c=this.MeasureText(l);n=new aX(this.text,a,c+f,(f*h)+f,c,this.line_widths,g.textAlign,g.textVAlign,f);if(this.image){n.SetImage(this.image,this.iw,this.ih,g.imagePosition,g.imagePadding,g.imageAlign,g.imageVAlign,g.imageScale)}b=n.Create(this.colour,this.bgColour,this.bgOutline,f*this.bgOutlineThickness,g.shadow,f*g.shadowBlur,d,f*this.padding,f*this.bgRadius);if(g.outlineMethod=="colour"){this.oimage=n.Create(g.outlineColour,this.bgColour,g.outlineColour,f*this.bgOutlineThickness,g.shadow,f*g.shadowBlur,d,f*this.padding,f*this.bgRadius)}else{if(g.outlineMethod=="size"){k=aM(this.text,this.textFont,this.textHeight+g.outlineIncrease);e=k.max.y+k.min.y;a=(f*(this.textHeight+g.outlineIncrease))+"px "+this.textFont;l.font=a;c=this.MeasureText(l);n=new aX(this.text,a,c+f,(f*e)+f,c,this.line_widths,g.textAlign,g.textVAlign,f);if(this.image){n.SetImage(this.image,this.iw+g.outlineIncrease,this.ih+g.outlineIncrease,g.imagePosition,g.imagePadding,g.imageAlign,g.imageVAlign,g.imageScale)
}this.oimage=n.Create(this.colour,this.bgColour,this.bgOutline,f*this.bgOutlineThickness,g.shadow,f*g.shadowBlur,d,f*this.padding,f*this.bgRadius);if(g.outlineIncrease>0){b=aK(b,this.oimage.width,this.oimage.height)}else{this.oimage=aK(this.oimage,b.width,b.height)}}}if(b){this.fimage=b;m=this.fimage.width/f;h=this.fimage.height/f}this.SetDraw(g);g.txtOpt=!!this.fimage}this.h=h;this.w=m};a1.SetFont=function(b,d,a,c){this.textFont=b;this.colour=d;this.bgColour=a;this.bgOutline=c;this.Measure(this.tc.ctxt,this.tc)};a1.SetWeight=function(a){var b=this.tc,e=b.weightMode.split(/[, ]/),c,f,d=a.length;if(!this.HasText()){return}this.weighted=true;for(f=0;f<d;++f){c=e[f]||"size";if("both"==c){this.Weight(a[f],b.ctxt,b,"size",b.min_weight[f],b.max_weight[f],f);this.Weight(a[f],b.ctxt,b,"colour",b.min_weight[f],b.max_weight[f],f)}else{this.Weight(a[f],b.ctxt,b,c,b.min_weight[f],b.max_weight[f],f)}}this.Measure(b.ctxt,b)};a1.Weight=function(a,d,h,b,e,g,f){a=isNaN(a)?1:a;var c=(a-e)/(g-e);if("colour"==b){this.colour=aV(h,c,f)}else{if("bgcolour"==b){this.bgColour=aV(h,c,f)}else{if("bgoutline"==b){this.bgOutline=aV(h,c,f)}else{if("size"==b){if(h.weightSizeMin>0&&h.weightSizeMax>h.weightSizeMin){this.textHeight=h.weightSize*(h.weightSizeMin+(h.weightSizeMax-h.weightSizeMin)*c)}else{this.textHeight=aN(1,a*h.weightSize)}}}}}};a1.SetShadowColourFixed=function(a,b,c){a.shadowColor=b};a1.SetShadowColourAlpha=function(a,b,c){a.shadowColor=a9(b,c)};a1.DrawText=function(a,g,b){var f=this.tc,h=this.x,k=this.y,e=this.sc,d,c;a.globalAlpha=this.alpha;a.fillStyle=this.color;f.shadow&&this.SetShadowColour(a,f.shadow,this.alpha);a.font=this.font;h+=g/e;k+=(b/e)-(this.h/2);for(d=0;d<this.text.length;++d){c=h;if("right"==f.textAlign){c+=this.w/2-this.line_widths[d]}else{if("centre"==f.textAlign){c-=this.line_widths[d]/2}else{c-=this.w/2}}a.setTransform(e,0,0,e,e*c,e*k);a.fillText(this.text[d],0,0);k+=this.textHeight}};a1.DrawImage=function(a,f,b,m){var k=this.x,n=this.y,e=this.sc,d=m||this.fimage,h=this.w,c=this.h,l=this.alpha,g=this.shadow;a.globalAlpha=l;g&&this.SetShadowColour(a,g,l);k+=(f/e)-(h/2);n+=(b/e)-(c/2);a.setTransform(e,0,0,e,e*k,e*n);a.drawImage(d,0,0,h,c)};a1.DrawImageIE=function(a,f,b){var d=this.fimage,e=this.sc,g=d.width=this.w*e,c=d.height=this.h*e,h=(this.x*e)+f-(g/2),k=(this.y*e)+b-(c/2);a.setTransform(1,0,0,1,0,0);a.globalAlpha=this.alpha;a.drawImage(d,h,k)};a1.Calc=function(c,a){var b,e=this.tc,f=e.minBrightness,g=e.maxBrightness,d=e.max_radius;b=c.xform(this.position);this.xformed=b;b=a8(e,b,e.stretchX,e.stretchY);this.x=b.x;this.y=b.y;this.z=b.z;this.sc=b.w;this.alpha=a*bu(f+(g-f)*(d-this.z)/(2*d),0,1)};a1.UpdateActive=function(d,a,f){var g=this.outline,b=this.w,h=this.h,c=this.x-b/2,e=this.y-h/2;g.Update(c,e,b,h,this.sc,this.z,a,f);return g};a1.CheckActive=function(d,c,e){var b=this.tc,a=this.UpdateActive(d,c,e);return a.Active(d,b.mx,b.my)?a:null};a1.Clicked=function(d){var b=this.a,a=b.target,f=b.href,c;if(a!=""&&a!="_self"){if(self.frames[a]){self.frames[a].document.location=f}else{try{if(top.frames[a]){top.frames[a].document.location=f;return}}catch(e){}window.open(f,a)}return}if(bx.createEvent){c=bx.createEvent("MouseEvents");c.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null);if(!b.dispatchEvent(c)){return}}else{if(b.fireEvent){if(!b.fireEvent("onclick")){return}}}bx.location=f};function aH(c,b,h){var a,f,d=bx.getElementById(c),g=["id","class","innerHTML"],e;if(!d){throw 0}if(bK(window.G_vmlCanvasManager)){d=window.G_vmlCanvasManager.initElement(d);this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])}if(d&&(!d.getContext||!d.getContext("2d").fillText)){f=bx.createElement("DIV");for(a=0;a<g.length;++a){f[g[a]]=d[g[a]]}d.parentNode.insertBefore(f,d);d.parentNode.removeChild(d);throw 0}for(a in aH.options){this[a]=h&&bK(h[a])?h[a]:(bK(aH[a])?aH[a]:aH.options[a])}this.canvas=d;this.ctxt=d.getContext("2d");this.z1=250/aN(this.depth,0.001);this.z2=this.z1/this.zoom;this.radius=bW(d.height,d.width)*0.0075;this.max_radius=100;this.max_weight=[];this.min_weight=[];this.textFont=this.textFont&&aR(this.textFont);this.textHeight*=1;this.imageRadius=this.imageRadius.toString();this.pulsateTo=bu(this.pulsateTo,0,1);this.minBrightness=bu(this.minBrightness,0,1);this.maxBrightness=bu(this.maxBrightness,this.minBrightness,1);this.ctxt.textBaseline="top";this.lx=(this.lock+"").indexOf("x")+1;this.ly=(this.lock+"").indexOf("y")+1;this.frozen=this.dx=this.dy=this.fixedAnim=this.touchState=0;this.fixedAlpha=1;this.source=b||c;this.repeatTags=bW(64,~~this.repeatTags);this.minTags=bW(200,~~this.minTags);if(~~this.scrollPause>0){aH.scrollPause=~~this.scrollPause}else{this.scrollPause=0}if(this.minTags>0&&this.repeatTags<1&&(a=this.GetTags().length)){this.repeatTags=bD(this.minTags/a)-1}this.transform=bc.Identity();this.startTime=this.time=bp();this.mx=this.my=-1;this.centreImage&&bE(this);this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition;this.animTiming=(typeof aH[this.animTiming]=="function"?aH[this.animTiming]:aH.Smooth);
if(this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]){this.ctxt.shadowColor=this.shadow;this.shadow=this.ctxt.shadowColor;this.shadowAlpha=bH()}else{delete this.shadow}this.Load();if(b&&this.hideTags){(function(k){if(aH.loaded){k.HideTags()}else{bP("load",function(){k.HideTags()},window)}})(this)}this.yaw=this.initial?this.initial[0]*this.maxSpeed:0;this.pitch=this.initial?this.initial[1]*this.maxSpeed:0;if(this.tooltip){this.ctitle=d.title;d.title="";if(this.tooltip=="native"){this.Tooltip=this.TooltipNative}else{this.Tooltip=this.TooltipDiv;if(!this.ttdiv){this.ttdiv=bx.createElement("div");this.ttdiv.className=this.tooltipClass;this.ttdiv.style.position="absolute";this.ttdiv.style.zIndex=d.style.zIndex+1;bP("mouseover",function(k){k.target.style.display="none"},this.ttdiv);bx.body.appendChild(this.ttdiv)}}}else{this.Tooltip=this.TooltipNone}if(!this.noMouse&&!a2[c]){a2[c]=[["mousemove",bN],["mouseout",bz],["mouseup",bV],["touchstart",ba],["touchend",aO],["touchcancel",aO],["touchmove",bm]];if(this.dragControl){a2[c].push(["mousedown",j]);a2[c].push(["selectstart",bZ])}if(this.wheelZoom){a2[c].push(["mousewheel",bM]);a2[c].push(["DOMMouseScroll",bM])}if(this.scrollPause){a2[c].push(["scroll",bQ,window])}for(a=0;a<a2[c].length;++a){f=a2[c][a];bP(f[0],f[1],f[2]?f[2]:d)}}if(!aH.started){e=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;aH.NextFrame=e?aH.NextFrameRAF:aH.NextFrameTimeout;aH.interval=this.interval;aH.NextFrame(this.interval);aH.started=1}}bd=aH.prototype;bd.SourceElements=function(){if(bx.querySelectorAll){return bx.querySelectorAll("#"+this.source)}return[bx.getElementById(this.source)]};bd.HideTags=function(){var a=this.SourceElements(),b;for(b=0;b<a.length;++b){a[b].style.display="none"}};bd.GetTags=function(){var b=this.SourceElements(),c,f=[],d,e,a;for(a=0;a<=this.repeatTags;++a){for(d=0;d<b.length;++d){c=b[d].getElementsByTagName("a");for(e=0;e<c.length;++e){f.push(c[e])}}}return f};bd.Message=function(g){var e=[],b,d,c=g.split(""),k,f,h,a;for(b=0;b<c.length;++b){if(c[b]!=" "){d=b-c.length/2;k=bx.createElement("A");k.href="#";k.innerText=c[b];h=100*bL(d/9);a=-100*aJ(d/9);f=new aZ(this,c[b],k,[h,0,a],2,18,"#000","#fff",0,0,0,"monospace",2,c[b]);f.Init();e.push(f)}}return e};bd.CreateTag=function(k){var f,a,e,l,g,c,h,b,d=[0,0,0];if("text"!=this.imageMode){f=k.getElementsByTagName("img");if(f.length){a=new Image;a.src=f[0].src;if(!this.imageMode){e=new aZ(this,"",k,d,0,0);e.SetImage(a);bs(a,f[0],e,this);return e}}}if("image"!=this.imageMode){g=new bY(k);l=g.Lines();if(!g.Empty()){c=this.textFont||aR(a5(k,"font-family"));if(this.splitWidth){l=g.SplitWidth(this.splitWidth,this.ctxt,c,this.textHeight)}h=this.bgColour=="tag"?a5(k,"background-color"):this.bgColour;b=this.bgOutline=="tag"?a5(k,"color"):this.bgOutline}else{g=null}}if(g||a){e=new aZ(this,l,k,d,2,this.textHeight+2,this.textColour||a5(k,"color"),h,this.bgRadius,b,this.bgOutlineThickness,c,this.padding,g&&g.original);if(a){e.SetImage(a);bs(a,f[0],e,this)}else{e.Init()}return e}};bd.UpdateTag=function(a,c){var d=this.textColour||a5(c,"color"),b=this.textFont||aR(a5(c,"font-family")),e=this.bgColour=="tag"?a5(c,"background-color"):this.bgColour,f=this.bgOutline=="tag"?a5(c,"color"):this.bgOutline;a.a=c;a.title=c.title;if(a.colour!=d||a.textFont!=b||a.bgColour!=e||a.bgOutline!=f){a.SetFont(b,d,e,f)}};bd.Weight=function(f){var a=f.length,h,c,e,k=[],d,b=this.weightFrom?this.weightFrom.split(/[, ]/):[null],g=b.length;for(c=0;c<a;++c){k[c]=[];for(e=0;e<g;++e){h=aL(f[c].a,b[e],this.textHeight);if(!this.max_weight[e]||h>this.max_weight[e]){this.max_weight[e]=h}if(!this.min_weight[e]||h<this.min_weight[e]){this.min_weight[e]=h}k[c][e]=h}}for(e=0;e<g;++e){if(this.max_weight[e]>this.min_weight[e]){d=1}}if(d){for(c=0;c<a;++c){f[c].SetWeight(k[c])}}};bd.Load=function(){var e=this.GetTags(),l=[],g,f,m,b,c,d,a,h,n=[],k={sphere:aP,vcylinder:bG,hcylinder:bw,vring:a0,hring:aS};if(e.length){n.length=e.length;for(h=0;h<e.length;++h){n[h]=h}this.shuffleTags&&bF(n);b=100*this.radiusX;c=100*this.radiusY;d=100*this.radiusZ;this.max_radius=aN(b,aN(c,d));for(h=0;h<e.length;++h){f=this.CreateTag(e[n[h]]);if(f){l.push(f)}}this.weight&&this.Weight(l,true);if(this.shapeArgs){this.shapeArgs[0]=l.length}else{m=this.shape.toString().split(/[(),]/);g=m.shift();if(typeof window[g]==="function"){this.shape=window[g]}else{this.shape=k[g]||k.sphere}this.shapeArgs=[l.length,b,c,d].concat(m)}a=this.shape.apply(this,this.shapeArgs);this.listLength=l.length;for(h=0;h<l.length;++h){l[h].position=new bO(a[h][0],a[h][1],a[h][2])}}if(this.noTagsMessage&&!l.length){l=this.Message("No tags")}this.taglist=l};bd.Update=function(){var e=this.GetTags(),f=[],m=this.taglist,d,g=[],k=[],b,h,c,l,a;if(!this.shapeArgs){return this.Load()}if(e.length){c=this.listLength=e.length;h=m.length;for(l=0;l<h;++l){f.push(m[l]);k.push(l)}for(l=0;l<c;++l){for(a=0,d=0;a<h;++a){if(m[a].EqualTo(e[l])){this.UpdateTag(f[a],e[l]);
d=k[a]=-1}}if(!d){g.push(l)}}for(l=0,a=0;l<h;++l){if(k[a]==-1){k.splice(a,1)}else{++a}}if(k.length){bF(k);while(k.length&&g.length){l=k.shift();a=g.shift();f[l]=this.CreateTag(e[a])}k.sort(function(n,o){return n-o});while(k.length){f.splice(k.pop(),1)}}a=f.length/(g.length+1);l=0;while(g.length){f.splice(bD(++l*a),0,this.CreateTag(e[g.shift()]))}this.shapeArgs[0]=c=f.length;b=this.shape.apply(this,this.shapeArgs);for(l=0;l<c;++l){f[l].position=new bO(b[l][0],b[l][1],b[l][2])}this.weight&&this.Weight(f)}this.taglist=f};bd.SetShadow=function(a){a.shadowBlur=this.shadowBlur;a.shadowOffsetX=this.shadowOffset[0];a.shadowOffsetY=this.shadowOffset[1]};bd.Draw=function(h){if(this.paused){return}var p=this.canvas,r=p.width,k=p.height,f=0,s=(h-this.time)*aH.interval/1000,l=r/2+this.offsetX,m=k/2+this.offsetY,b=this.ctxt,n,a,d,t=-1,q=this.taglist,e=q.length,u=this.frontSelect,g=(this.centreFunc==bZ),o;this.time=h;if(this.frozen&&this.drawn){return this.Animate(r,k,s)}o=this.AnimateFixed();b.setTransform(1,0,0,1,0,0);for(d=0;d<e;++d){q[d].Calc(this.transform,this.fixedAlpha)}q=bA(q,function(w,v){return v.z-w.z});if(o&&this.fixedAnim.active){n=this.fixedAnim.tag.UpdateActive(b,l,m)}else{this.active=null;for(d=0;d<e;++d){a=this.mx>=0&&this.my>=0&&this.taglist[d].CheckActive(b,l,m);if(a&&a.sc>f&&(!u||a.z<=0)){n=a;t=d;n.tag=this.taglist[d];f=a.sc}}this.active=n}this.txtOpt||(this.shadow&&this.SetShadow(b));b.clearRect(0,0,r,k);for(d=0;d<e;++d){if(!g&&q[d].z<=0){try{this.centreFunc(b,r,k,l,m)}catch(c){alert(c);this.centreFunc=bZ}g=true}if(!(n&&n.tag==q[d]&&n.PreDraw(b,q[d],l,m))){q[d].Draw(b,l,m)}n&&n.tag==q[d]&&n.PostDraw(b)}if(this.freezeActive&&n){this.Freeze()}else{this.UnFreeze();this.drawn=(e==this.listLength)}if(this.fixedCallback){this.fixedCallback(this,this.fixedCallbackTag);this.fixedCallback=null}o||this.Animate(r,k,s);n&&n.LastDraw(b);p.style.cursor=n?this.activeCursor:"";this.Tooltip(n,this.taglist[t])};bd.TooltipNone=function(){};bd.TooltipNative=function(a,b){if(a){this.canvas.title=b&&b.title?b.title:""}else{this.canvas.title=this.ctitle}};bd.SetTTDiv=function(d,b){var c=this,a=c.ttdiv.style;if(d!=c.ttdiv.innerHTML){a.display="none"}c.ttdiv.innerHTML=d;b&&(b.title=c.ttdiv.innerHTML);if(a.display=="none"&&!c.tttimer){c.tttimer=setTimeout(function(){var e=bR(c.canvas.id);a.display="block";a.left=e.x+c.mx+"px";a.top=e.y+c.my+24+"px";c.tttimer=null},c.tooltipDelay)}};bd.TooltipDiv=function(a,b){if(a&&b&&b.title){this.SetTTDiv(b.title,b)}else{if(!a&&this.mx!=-1&&this.my!=-1&&this.ctitle.length){this.SetTTDiv(this.ctitle)}else{this.ttdiv.style.display="none"}}};bd.Transform=function(k,e,g){if(e||g){var d=bL(e),h=aJ(e),f=bL(g),a=aJ(g),c=new bc([a,0,f,0,1,0,-f,0,a]),b=new bc([1,0,0,0,h,-d,0,d,h]);k.transform=k.transform.mul(c.mul(b))}};bd.AnimateFixed=function(){var a,b,d,c,e;if(this.fadeIn){b=bp()-this.startTime;if(b>=this.fadeIn){this.fadeIn=0;this.fixedAlpha=1}else{this.fixedAlpha=b/this.fadeIn}}if(this.fixedAnim){if(!this.fixedAnim.transform){this.fixedAnim.transform=this.transform}a=this.fixedAnim,b=bp()-a.t0,d=a.angle,c,e=this.animTiming(a.t,b);this.transform=a.transform;if(b>=a.t){this.fixedCallbackTag=a.tag;this.fixedCallback=a.cb;this.fixedAnim=this.yaw=this.pitch=0}else{d*=e}c=bc.Rotation(d,a.axis);this.transform=this.transform.mul(c);return(this.fixedAnim!=0)}return false};bd.AnimatePosition=function(a,f,h){var b=this,c=b.mx,d=b.my,g,e;if(!b.frozen&&c>=0&&d>=0&&c<a&&d<f){g=b.maxSpeed,e=b.reverse?-1:1;b.lx||(b.yaw=((c*2*g/a)-g)*e*h);b.ly||(b.pitch=((d*2*g/f)-g)*-e*h);b.initial=null}else{if(!b.initial){if(b.frozen&&!b.freezeDecel){b.yaw=b.pitch=0}else{b.Decel(b)}}}this.Transform(b,b.pitch,b.yaw)};bd.AnimateDrag=function(b,d,e){var c=this,a=100*e*c.maxSpeed/c.max_radius/c.zoom;if(c.dx||c.dy){c.lx||(c.yaw=c.dx*a/c.stretchX);c.ly||(c.pitch=c.dy*-a/c.stretchY);c.dx=c.dy=0;c.initial=null}else{if(!c.initial){c.Decel(c)}}this.Transform(c,c.pitch,c.yaw)};bd.Freeze=function(){if(!this.frozen){this.preFreeze=[this.yaw,this.pitch];this.frozen=1;this.drawn=0}};bd.UnFreeze=function(){if(this.frozen){this.yaw=this.preFreeze[0];this.pitch=this.preFreeze[1];this.frozen=0}};bd.Decel=function(c){var a=c.minSpeed,d=bi(c.yaw),b=bi(c.pitch);if(!c.lx&&d>a){c.yaw=d>c.z0?c.yaw*c.decel:0}if(!c.ly&&b>a){c.pitch=b>c.z0?c.pitch*c.decel:0}};bd.Zoom=function(a){this.z2=this.z1*(1/a);this.drawn=0};bd.Clicked=function(a){var c=this.active;try{if(c&&c.tag){if(this.clickToFront===false||this.clickToFront===null){c.tag.Clicked(a)}else{this.TagToFront(c.tag,this.clickToFront,function(){c.tag.Clicked(a)},true)}}}catch(b){}};bd.Wheel=function(b){var a=this.zoom+this.zoomStep*(b?1:-1);this.zoom=bW(this.zoomMax,aN(this.zoomMin,a));this.Zoom(this.zoom)};bd.BeginDrag=function(a){this.down=bb(a,this.canvas);a.cancelBubble=true;a.returnValue=false;a.preventDefault&&a.preventDefault()};bd.Drag=function(d,e){if(this.dragControl&&this.down){var a=this.dragThreshold*this.dragThreshold,b=e.x-this.down.x,c=e.y-this.down.y;if(this.dragging||b*b+c*c>a){this.dx=b;
this.dy=c;this.dragging=1;this.down=e}}return this.dragging};bd.EndDrag=function(){var a=this.dragging;this.dragging=this.down=null;return a};function bv(a){var b=a.targetTouches[0],c=a.targetTouches[1];return br(by(c.pageX-b.pageX,2)+by(c.pageY-b.pageY,2))}bd.BeginPinch=function(a){this.pinched=[bv(a),this.zoom];a.preventDefault&&a.preventDefault()};bd.Pinch=function(b){var d,a,c=this.pinched;if(!c){return}a=bv(b);d=c[1]*a/c[0];this.zoom=bW(this.zoomMax,aN(this.zoomMin,d));this.Zoom(this.zoom)};bd.EndPinch=function(a){this.pinched=null};bd.Pause=function(){this.paused=true};bd.Resume=function(){this.paused=false};bd.SetSpeed=function(a){this.initial=a;this.yaw=a[0]*this.maxSpeed;this.pitch=a[1]*this.maxSpeed};bd.FindTag=function(a){if(!bK(a)){return null}bK(a.index)&&(a=a.index);if(!bl(a)){return this.taglist[a]}var d,c,b;if(bK(a.id)){d="id",c=a.id}else{if(bK(a.text)){d="innerText",c=a.text}}for(b=0;b<this.taglist.length;++b){if(this.taglist[b].a[d]==c){return this.taglist[b]}}};bd.RotateTag=function(f,b,g,e,k,c){var h=f.xformed,m=new bO(h.x,h.y,h.z),a=bJ(g,b),d=m.angle(a),l=m.cross(a).unit();if(d==0){this.fixedCallbackTag=f;this.fixedCallback=k}else{this.fixedAnim={angle:-d,axis:l,t:e,t0:bp(),cb:k,tag:f,active:c}}};bd.TagToFront=function(c,a,d,b){this.RotateTag(c,0,0,a,d,b)};aH.Start=function(a,c,b){aH.Delete(a);aH.tc[a]=new aH(a,c,b)};function bn(b,a){aH.tc[a]&&aH.tc[a][b]()}aH.Linear=function(b,a){return a/b};aH.Smooth=function(b,a){return 0.5-aJ(a*Math.PI/b)/2};aH.Pause=function(a){bn("Pause",a)};aH.Resume=function(a){bn("Resume",a)};aH.Reload=function(a){bn("Load",a)};aH.Update=function(a){bn("Update",a)};aH.SetSpeed=function(a,b){if(bl(b)&&aH.tc[a]&&!isNaN(b[0])&&!isNaN(b[1])){aH.tc[a].SetSpeed(b);return true}return false};aH.TagToFront=function(a,b){if(!bl(b)){return false}b.lat=b.lng=0;return aH.RotateTag(a,b)};aH.RotateTag=function(a,c){if(bl(c)&&aH.tc[a]){if(isNaN(c.time)){c.time=500}var b=aH.tc[a].FindTag(c);if(b){aH.tc[a].RotateTag(b,c.lat,c.lng,c.time,c.callback,c.active);return true}}return false};aH.Delete=function(c){var b,a;if(a2[c]){a=bx.getElementById(c);if(a){for(b=0;b<a2[c].length;++b){a3(a2[c][b][0],a2[c][b][1],a)}}}delete a2[c];delete aH.tc[c]};aH.NextFrameRAF=function(){requestAnimationFrame(bt)};aH.NextFrameTimeout=function(a){setTimeout(bf,a)};aH.tc={};aH.options={z1:20000,z2:20000,z0:0.0002,freezeActive:false,freezeDecel:false,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:false,depth:0.5,maxSpeed:0.05,minSpeed:0,decel:0.95,interval:20,minBrightness:0.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",outlineRadius:0,textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:true,zoom:1,weight:false,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",0.33:"#ff0",0.66:"#0f0",1:"#00f"},txtOpt:true,txtScale:2,frontSelect:false,wheelZoom:true,zoomMin:0.3,zoomMax:3,zoomStep:0.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:false,noSelect:false,noMouse:false,imageScale:1,paused:false,dragControl:false,dragThreshold:4,centreFunc:bZ,splitWidth:0,animTiming:"Smooth",clickToFront:false,fadeIn:0,padding:0,bgColour:null,bgRadius:0,bgOutline:null,bgOutlineThickness:0,outlineIncrease:4,textAlign:"centre",textVAlign:"middle",imageMode:null,imagePosition:null,imagePadding:2,imageAlign:"centre",imageVAlign:"middle",noTagsMessage:true,centreImage:null,pinchZoom:false,repeatTags:0,minTags:0,imageRadius:0,scrollPause:false};for(bh in aH.options){aH[bh]=aH.options[bh]}window.TagCanvas=aH;bP("load",function(){aH.loaded=1},window)})();