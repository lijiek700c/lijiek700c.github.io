<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
	<title>身份确认</title>
	<link rel="stylesheet" href="css/public2.css">
	<link rel="stylesheet" href="css/ball-spin-clockwise.css">
	<link rel="stylesheet" href="css/idVertificate.css">
	<script src="http://zwtest.benxiangai.com/net/zwwindow/zwjdemo/JS/main.js"></script>
	<script src="http://zwtest.benxiangai.com/net/zwwindow/zwjdemo/JS/IDCard.js"></script>
</head>
<body>
<div class="ds-idVertificateBox" style="display:none;">
	<!--页头-->
	<div class="ds-header clear">
		<a class="fl" href="#">
			<i class="fl"></i>
			<span class="fl">湖南省公安接报案查询系统</span>
		</a>
		<div class="fr">
			<p class="iconP clear">
				<span class="fl txt">服务电话：</span>
				<span class="fl num" >400-800-2285</span>
			</p>
			<p class="num">湖南湘江智慧科技股份有限公司</p>
		</div>
	</div>
	<!--操作步骤S-->
	<div class="ds-queryProceBox">
		<div class="ds-proceBtn ds-proceHome"></div>
		<div class="ds-proceBtn ds-proce sel">身份确认</div>
		<div class="ds-proceBtn ds-proce">案件查询</div>
		<div class="ds-proceBtn ds-proce">案件列表</div>
		<div class="ds-proceBtn ds-proce">案件详情</div>
		<div class="ds-proceBtn ds-proce">完成查询</div>
	</div>
	<!--操作步骤E-->
	<div class="ds-searchBox">
		<!--输入框-->
		<div class="ds-inputArea clear">
			<label class="fl clear" for="">
				<span class="fl">身份证号</span>
				<input name="key1" class="fl" type="text">
			</label>
			<p class="fl">重新读取</p>
		</div>
	</div>
	<!--提示扫描身份证-->
	<div class="ds-notice">
		<img src="images/idVertificate.gif" alt="">
	</div>
	<!--页脚-->
	<div class="ds-footer clear">
		<div class="fl footerTxt"> 
			<p>温馨提示：把身份证放置左边感应区，读取信息成功后，点击“下一步”进行操作。</p>
			<p>若未识别到信息，请点击“重新读取”。</p>
		</div>
		<div class="fr btnBox clear">
			<span class="fl home"></span>
			<span class="fl return"></span>
			<span class="fl next"></span>
		</div>
	</div>
</div>
<!--加载S-->
    <div class="ds-loadingBox" style="display:none;">
        <div class="ds-wrapper">
            <div class="la-ball-spin-clockwise la-2x">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="ds-loadingTxt" style="color:#000;">
                <span>正在加载</span>
                <div>
                    <p class="first">.</p>
                    <p class="second">.</p>
                    <p class="third">.</p>
                </div>
            </div>
        </div>
    </div>
<!--加载E-->

	<!--调摄像头拍照S-->
	<div class="ds-getCamera">
		<div class="ds-cameraArea">
			<div class="ds-cameraBox">
				<video width="800" height="600" autoplay id="video"></video>
				<canvas width="800" height="600" id="canvas"></canvas>
			</div>
			<span>拍照</span>
		</div>
	</div>
    <!--调摄像头拍照E-->
<img id="photo" src="" alt="">
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/ds-public.js"></script>
<script>
console.log(window.external);
function readIdInfo() {
    send_command(
    "idReaderReadInfo",
    "nothing",
    function (receivedData) {
        var idInfo = JSON.parse(receivedData);
        document.getElementById("photo").src = "data:image/jpeg;base64," + idInfo.idImg;
        logger(receivedData);
    });
}
readIdInfo();
/**/
window.addEventListener('DOMContentLoaded',function(){
	var video=document.getElementById('video'),
		canvas=document.getElementById('canvas'),
		ctx=canvas.getContext('2d');
    navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;
	navigator.getUserMedia({video:true},goStream,noStream);
	/*打开摄像头*/
	function goStream(stream){
		video.src=URL.createObjectURL(stream);
		video.onerror=function (){  
          stream.stop();  
        };  
        stream.onended=noStream;  
        video.onloadedmetadata=function(){  
          console.log('摄像头成功打开！');  
        };
	}
	function noStream(err){
		console.warn(err);
	}

/*拍照显示到canvas*/
/*snap.addEventListener('click',function(){
	alert('拍照');
	//绘制canvas图形
    ctx.drawImage(video, 0, 0, 600, 480);
    //把canvas图像转为img图片
    img.src = ctx.toDataURL("image/png");
},false);*/
/*下载所拍图片*/
/*download.addEventListener('click',function(){
	downloadImg('png');
},false);*/

	function downloadImg(type) {
		console.log(ctx);
	    //设置保存图片的类型
	    var imgdata=ctx.toDataURL(type);
	    //将mime-type改为image/octet-stream,强制让浏览器下载
	    var fixtype=function (type) {
	        type=type.toLocaleLowerCase().replace(/jpg/i,'jpeg');
	        var r=type.match(/png|jpeg|bmp|gif/)[0];
	        return 'image/'+r;
	    }
	    imgdata=imgdata.replace(fixtype(type), 'image/octet-stream')
	    //将图片保存到本地
	    var saveFile=function (data, filename) {
	        var link=document.createElement('a');
	        link.href=data;
	        link.download=filename;
	        var event=document.createEvent('MouseEvents');
	        event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
	        link.dispatchEvent(event);
	    }
	    var filename=new Date().toLocaleDateString() + '.' + type;
	    saveFile(imgdata, filename);
	}
});
/**/
$(function(){
   /*打开页面时的加载动画*/
   firstOpen('','.ds-idVertificateBox');
   hideLoading({
   		txt:'',
   		str:'.ds-idVertificateBox'			
   });
   var aSpan=$('div.btnBox > span','.ds-footer');
	aSpan.on('click',function(){
		var _this=$(this);
		if(_this.hasClass('next')){
			window.location.href='caseSearch.html';
		}else if(_this.hasClass('return')){
			window.location.href='threeChoices.html';
		}else{
			window.location.href='threeChoices.html';
		}
	});
	/**/
	$('.ds-getCamera span').on('click',function(){
		var _this=$(this);
		_this.parents('.ds-getCamera').fadeOut(200);
	});
});
</script>
</body>
</html>